<!DOCTYPE html>
<html lang="fa" dir="rtl">
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<title>Mia AI â€“ Ø¯Ø³ØªÛŒØ§Ø± Ø­Ø³Ø§Ø¨Ø¯Ø§Ø±ÛŒ Ù‡ÙˆØ´Ù…Ù†Ø¯</title>

<!-- Chart.js -->
<script src="https://cdn.jsdelivr.net/npm/chart.js"></script>

<style>
:root {
  --color-bg: #f7f7f7;
  --color-text: #222;
  --color-primary: #4a90e2;
  --color-card: #fff;
  --color-border: #ccc;
}
body.dark {
  --color-bg: #1c1c1e;
  --color-text: #eee;
  --color-card: #2c2c2e;
  --color-border: #444;
}
body.parmis {
  --color-bg: #eaf2f8;
  --color-text: #2e4053;
  --color-primary: #2874a6;
}
body.modern {
  --color-bg: #ffffff;
  --color-text: #111;
  --color-primary: #6c63ff;
  --color-card: #fafafa;
}

body {
  font-family: "Vazirmatn", sans-serif;
  background: var(--color-bg);
  color: var(--color-text);
  margin: 0;
  padding: 0;
  transition: background 0.3s, color 0.3s;
}

header {
  background: var(--color-primary);
  color: white;
  padding: 1rem;
  text-align: center;
  font-weight: bold;
  font-size: 1.2rem;
  border-bottom: 3px solid var(--color-border);
}

nav {
  display: flex;
  justify-content: space-around;
  background: var(--color-card);
  border-top: 1px solid var(--color-border);
  border-bottom: 1px solid var(--color-border);
  padding: 0.5rem 0;
}

nav button {
  background: none;
  border: none;
  font-size: 1rem;
  cursor: pointer;
  color: var(--color-primary);
}

section {
  padding: 1rem;
}

.card {
  background: var(--color-card);
  border: 1px solid var(--color-border);
  border-radius: 10px;
  padding: 1rem;
  margin-bottom: 1rem;
}

input, select, button, textarea {
  width: 100%;
  padding: 0.5rem;
  border: 1px solid var(--color-border);
  border-radius: 6px;
  font-size: 1rem;
  margin-bottom: 0.5rem;
}

button.primary {
  background: var(--color-primary);
  color: white;
  border: none;
  cursor: pointer;
}

.chart-container {
  width: 100%;
  height: 250px;
}

.hidden {
  display: none;
}
</style>
</head>

<body class="parmis">
<header>ğŸ“Š Mia AI â€“ Ø­Ø³Ø§Ø¨Ø¯Ø§Ø± Ù‡ÙˆØ´Ù…Ù†Ø¯</header>

<nav>
  <button onclick="showSection('dashboard')">Ø®Ø§Ù†Ù‡</button>
  <button onclick="showSection('transactions')">ØªØ±Ø§Ú©Ù†Ø´â€ŒÙ‡Ø§</button>
  <button onclick="showSection('reports')">Ú¯Ø²Ø§Ø±Ø´</button>
  <button onclick="showSection('voice')">ğŸ¤ ØµÙˆØªÛŒ</button>
  <button onclick="showSection('settings')">âš™ï¸ ØªÙ†Ø¸ÛŒÙ…Ø§Øª</button>
</nav>

<main>
  <!-- Ø¨Ø®Ø´ Ø¯Ø§Ø´Ø¨ÙˆØ±Ø¯ -->
  <section id="dashboard" class="card">
    <h3>Ø®Ù„Ø§ØµÙ‡ Ø­Ø³Ø§Ø¨</h3>
    <p>Ø¯Ø±Ø¢Ù…Ø¯ Ú©Ù„: <span id="totalIncome">Û°</span> ØªÙˆÙ…Ø§Ù†</p>
    <p>Ù‡Ø²ÛŒÙ†Ù‡ Ú©Ù„: <span id="totalExpense">Û°</span> ØªÙˆÙ…Ø§Ù†</p>
    <p>Ù…Ø§Ù†Ø¯Ù‡: <span id="balance">Û°</span> ØªÙˆÙ…Ø§Ù†</p>
  </section>

  <!-- Ø¨Ø®Ø´ ØªØ±Ø§Ú©Ù†Ø´â€ŒÙ‡Ø§ -->
  <section id="transactions" class="card hidden">
    <h3>Ø§ÙØ²ÙˆØ¯Ù† ØªØ±Ø§Ú©Ù†Ø´</h3>
    <select id="type">
      <option value="income">Ø¯Ø±Ø¢Ù…Ø¯</option>
      <option value="expense">Ù‡Ø²ÛŒÙ†Ù‡</option>
      <option value="transfer">Ø§Ù†ØªÙ‚Ø§Ù„</option>
    </select>
    <input type="text" id="desc" placeholder="ØªÙˆØ¶ÛŒØ­ (Ù…Ø«Ù„Ø§Ù‹ ÙØ±ÙˆØ´ Ú©Ø§Ù„Ø§)">
    <input type="number" id="amount" placeholder="Ù…Ø¨Ù„Øº">
    <button class="primary" onclick="addTransaction()">Ø°Ø®ÛŒØ±Ù‡ ØªØ±Ø§Ú©Ù†Ø´</button>

    <h4>Ù„ÛŒØ³Øª ØªØ±Ø§Ú©Ù†Ø´â€ŒÙ‡Ø§</h4>
    <div id="txList"></div>
  </section>
    <!-- Ø¨Ø®Ø´ Ú¯Ø²Ø§Ø±Ø´â€ŒÙ‡Ø§ -->
  <section id="reports" class="card hidden">
    <h3>Ú¯Ø²Ø§Ø±Ø´â€ŒÙ‡Ø§ÛŒ Ú¯Ø±Ø§ÙÛŒÚ©ÛŒ</h3>
    <div class="chart-container">
      <canvas id="chart"></canvas>
    </div>
    <button class="primary" onclick="generateChart()">Ù†Ù…Ø§ÛŒØ´ Ù†Ù…ÙˆØ¯Ø§Ø±</button>
  </section>

  <!-- Ø¨Ø®Ø´ Ù‡ÙˆØ´ ØµÙˆØªÛŒ -->
  <section id="voice" class="card hidden">
    <h3>Ø¯Ø³ØªÛŒØ§Ø± ØµÙˆØªÛŒ</h3>
    <p>Ø¨Ø±Ø§ÛŒ Ø§ÙØ²ÙˆØ¯Ù† ØªØ±Ø§Ú©Ù†Ø´ Ø¨Ø§ ØµØ¯Ø§ Ø¨Ú¯Ùˆ:  
    <b>Â«Ø¯Ø±Ø¢Ù…Ø¯ Ø§Ù…Ø±ÙˆØ² Ù¾Ù†Ø¬ Ù…ÛŒÙ„ÛŒÙˆÙ† Ø§Ø² ÙØ±ÙˆØ´Â»</b></p>
    <button id="startVoice" class="primary">ğŸ¤ Ø´Ø±ÙˆØ¹ Ú¯ÙˆØ´ Ø¯Ø§Ø¯Ù†</button>
    <p id="voiceText"></p>
  </section>

  <!-- Ø¨Ø®Ø´ ØªÙ†Ø¸ÛŒÙ…Ø§Øª -->
  <section id="settings" class="card hidden">
    <h3>ØªÙ†Ø¸ÛŒÙ…Ø§Øª</h3>
    <label>Ø§Ù†ØªØ®Ø§Ø¨ ØªÙ…:</label>
    <select id="themeSelect" onchange="changeTheme(this.value)">
      <option value="parmis">Ù¾Ø§Ø±Ù…ÛŒØ³</option>
      <option value="dark">ØªÛŒØ±Ù‡</option>
      <option value="modern">Ù…Ø¯Ø±Ù†</option>
      <option value="light">Ø±ÙˆØ´Ù†</option>
    </select>

    <label>Ø¨Ú©Ø§Ù¾ Ø¯Ø§Ø¯Ù‡â€ŒÙ‡Ø§</label>
    <button onclick="backupData()">ğŸ“¦ ØªÙ‡ÛŒÙ‡ Ù†Ø³Ø®Ù‡ Ù¾Ø´ØªÛŒØ¨Ø§Ù†</button>

    <label>Ø¨Ø§Ø²ÛŒØ§Ø¨ÛŒ Ø¯Ø§Ø¯Ù‡â€ŒÙ‡Ø§</label>
    <input type="file" id="restoreFile" onchange="restoreData(event)">

    <h4>Ø±Ù…Ø²Ú¯Ø°Ø§Ø±ÛŒ (AES)</h4>
    <input type="password" id="aesKey" placeholder="Ú©Ù„ÛŒØ¯ Ø±Ù…Ø²Ú¯Ø°Ø§Ø±ÛŒ">
    <button class="primary" onclick="encryptData()">Ø±Ù…Ø²Ú¯Ø°Ø§Ø±ÛŒ Ø¯Ø§Ø¯Ù‡â€ŒÙ‡Ø§</button>
  </section>
</main>

<script>
// ------------------------------
// ğŸ”¹ Ù…Ø¯ÛŒØ±ÛŒØª Ø¨Ø®Ø´â€ŒÙ‡Ø§
// ------------------------------
function showSection(id) {
  document.querySelectorAll("section").forEach(s => s.classList.add("hidden"));
  document.getElementById(id).classList.remove("hidden");
}

// ------------------------------
// ğŸ”¹ Ø¯Ø§Ø¯Ù‡â€ŒÙ‡Ø§ Ùˆ ØªØ±Ø§Ú©Ù†Ø´â€ŒÙ‡Ø§
// ------------------------------
let transactions = JSON.parse(localStorage.getItem('transactions') || '[]');

function addTransaction() {
  const type = document.getElementById('type').value;
  const desc = document.getElementById('desc').value;
  const amount = parseFloat(document.getElementById('amount').value);

  if (!desc || !amount) return alert("ØªÙˆØ¶ÛŒØ­ Ùˆ Ù…Ø¨Ù„Øº Ø±Ø§ ÙˆØ§Ø±Ø¯ Ú©Ù†ÛŒØ¯");

  transactions.push({ type, desc, amount, date: new Date().toLocaleDateString('fa-IR') });
  localStorage.setItem('transactions', JSON.stringify(transactions));
  updateDashboard();
  renderList();
  alert("âœ… ØªØ±Ø§Ú©Ù†Ø´ Ø«Ø¨Øª Ø´Ø¯");
  document.getElementById('desc').value = '';
  document.getElementById('amount').value = '';
}

function renderList() {
  const list = document.getElementById('txList');
  list.innerHTML = transactions.map(t =>
    `<div class="card">
      <b>${t.type === 'income' ? 'ğŸ’° Ø¯Ø±Ø¢Ù…Ø¯' : t.type === 'expense' ? 'ğŸ’¸ Ù‡Ø²ÛŒÙ†Ù‡' : 'ğŸ” Ø§Ù†ØªÙ‚Ø§Ù„'}</b>
      <p>${t.desc}</p>
      <p>${t.amount.toLocaleString()} ØªÙˆÙ…Ø§Ù†</p>
      <small>${t.date}</small>
    </div>`
  ).join('');
}

function updateDashboard() {
  let income = transactions.filter(t => t.type === 'income').reduce((a,b)=>a+b.amount,0);
  let expense = transactions.filter(t => t.type === 'expense').reduce((a,b)=>a+b.amount,0);
  document.getElementById('totalIncome').textContent = income.toLocaleString();
  document.getElementById('totalExpense').textContent = expense.toLocaleString();
  document.getElementById('balance').textContent = (income - expense).toLocaleString();
}
updateDashboard();
renderList();

// ------------------------------
// ğŸ“Š Ú¯Ø²Ø§Ø±Ø´â€ŒÙ‡Ø§
// ------------------------------
function generateChart() {
  const ctx = document.getElementById('chart');
  const income = transactions.filter(t => t.type === 'income').reduce((a,b)=>a+b.amount,0);
  const expense = transactions.filter(t => t.type === 'expense').reduce((a,b)=>a+b.amount,0);
  new Chart(ctx, {
    type: 'pie',
    data: {
      labels: ['Ø¯Ø±Ø¢Ù…Ø¯', 'Ù‡Ø²ÛŒÙ†Ù‡'],
      datasets: [{
        data: [income, expense],
        borderWidth: 1
      }]
    }
  });
}

// ------------------------------
// ğŸ¤ Ù‡ÙˆØ´ ØµÙˆØªÛŒ (SpeechRecognition)
// ------------------------------
const SpeechRecognition = window.SpeechRecognition || window.webkitSpeechRecognition;
if (SpeechRecognition) {
  const recognizer = new SpeechRecognition();
  recognizer.lang = 'fa-IR';
  recognizer.continuous = false;

  document.getElementById('startVoice').onclick = () => {
    recognizer.start();
    document.getElementById('voiceText').textContent = "Ø¯Ø± Ø­Ø§Ù„ Ú¯ÙˆØ´ Ø¯Ø§Ø¯Ù†...";
  };

  recognizer.onresult = (event) => {
    const text = event.results[0][0].transcript;
    document.getElementById('voiceText').textContent = text;
    parseVoiceCommand(text);
  };
}

function parseVoiceCommand(text) {
  if (text.includes('Ø¯Ø±Ø¢Ù…Ø¯')) {
    let amount = extractNumber(text);
    transactions.push({type: 'income', desc: 'Ø¯Ø±Ø¢Ù…Ø¯ ØµÙˆØªÛŒ', amount});
  } else if (text.includes('Ù‡Ø²ÛŒÙ†Ù‡')) {
    let amount = extractNumber(text);
    transactions.push({type: 'expense', desc: 'Ù‡Ø²ÛŒÙ†Ù‡ ØµÙˆØªÛŒ', amount});
  }
  localStorage.setItem('transactions', JSON.stringify(transactions));
  updateDashboard();
  renderList();
}

function extractNumber(text) {
  const match = text.match(/\d+/g);
  return match ? parseInt(match.join('')) : 0;
}
  // ------------------------------
// ğŸ”’ Ø±Ù…Ø²Ú¯Ø°Ø§Ø±ÛŒ Ø¯Ø§Ø¯Ù‡â€ŒÙ‡Ø§ (AES)
// ------------------------------
async function encryptData() {
  const keyText = document.getElementById('aesKey').value;
  if (!keyText) return alert('Ú©Ù„ÛŒØ¯ Ø±Ù…Ø²Ú¯Ø°Ø§Ø±ÛŒ Ø±Ø§ ÙˆØ§Ø±Ø¯ Ú©Ù†ÛŒØ¯');
  const enc = new TextEncoder();
  const key = await crypto.subtle.importKey(
    'raw', enc.encode(keyText), 'AES-GCM', false, ['encrypt']
  );
  const iv = crypto.getRandomValues(new Uint8Array(12));
  const data = JSON.stringify(transactions);
  const encrypted = await crypto.subtle.encrypt(
    { name: 'AES-GCM', iv }, key, enc.encode(data)
  );
  const blob = new Blob([iv, new Uint8Array(encrypted)], { type: 'application/octet-stream' });
  const link = document.createElement('a');
  link.href = URL.createObjectURL(blob);
  link.download = 'backup_encrypted.dat';
  link.click();
  alert('âœ… Ø¯Ø§Ø¯Ù‡â€ŒÙ‡Ø§ Ø±Ù…Ø²Ú¯Ø°Ø§Ø±ÛŒ Ùˆ Ø¯Ø§Ù†Ù„ÙˆØ¯ Ø´Ø¯Ù†Ø¯.');
}

// ------------------------------
// â˜ï¸ Ø¨Ú©Ø§Ù¾ Ùˆ Ø¨Ø§Ø²ÛŒØ§Ø¨ÛŒ Ø¯Ø§Ø¯Ù‡â€ŒÙ‡Ø§
// ------------------------------
function backupData() {
  const blob = new Blob([JSON.stringify(transactions, null, 2)], { type: 'application/json' });
  const link = document.createElement('a');
  link.href = URL.createObjectURL(blob);
  link.download = 'backup_miaai.json';
  link.click();
  alert('ğŸ“¦ Ù†Ø³Ø®Ù‡ Ù¾Ø´ØªÛŒØ¨Ø§Ù† Ø¢Ù…Ø§Ø¯Ù‡ Ø§Ø³Øª.');
}

function restoreData(event) {
  const file = event.target.files[0];
  if (!file) return;
  const reader = new FileReader();
  reader.onload = e => {
    transactions = JSON.parse(e.target.result);
    localStorage.setItem('transactions', JSON.stringify(transactions));
    updateDashboard();
    renderList();
    alert('âœ… Ø¯Ø§Ø¯Ù‡â€ŒÙ‡Ø§ Ø¨Ø§ Ù…ÙˆÙÙ‚ÛŒØª Ø¨Ø§Ø²ÛŒØ§Ø¨ÛŒ Ø´Ø¯Ù†Ø¯.');
  };
  reader.readAsText(file);
}

// ------------------------------
// ğŸ”” Ø§Ø¹Ù„Ø§Ù†â€ŒÙ‡Ø§ (Notifications)
// ------------------------------
if ('Notification' in window) {
  Notification.requestPermission().then(p => {
    if (p === 'granted') {
      scheduleReminders();
    }
  });
}

function scheduleReminders() {
  setTimeout(() => {
    new Notification('ğŸ”” ÛŒØ§Ø¯Ø¢ÙˆØ±ÛŒ Mia AI', {
      body: 'Ø³Ø±Ø±Ø³ÛŒØ¯ Ø§Ù‚Ø³Ø§Ø· ÛŒØ§ Ú†Ú©â€ŒÙ‡Ø§ÛŒ Ø®ÙˆØ¯ Ø±Ø§ Ø¨Ø±Ø±Ø³ÛŒ Ú©Ù†ÛŒØ¯ ğŸ’³',
      icon: 'https://cdn-icons-png.flaticon.com/512/3135/3135715.png'
    });
  }, 10000); // Ù†Ù…Ø§ÛŒØ´ Ø§Ø¹Ù„Ø§Ù† Ù¾Ø³ Ø§Ø² Û±Û° Ø«Ø§Ù†ÛŒÙ‡ Ø¨Ù‡ Ø¹Ù†ÙˆØ§Ù† Ù†Ù…ÙˆÙ†Ù‡
}

// ------------------------------
// ğŸ¨ ØªØºÛŒÛŒØ± ØªÙ…â€ŒÙ‡Ø§
// ------------------------------
function changeTheme(theme) {
  document.body.className = theme === 'light' ? '' : theme;
  localStorage.setItem('theme', theme);
}
const savedTheme = localStorage.getItem('theme');
if (savedTheme) changeTheme(savedTheme);

// ------------------------------
// ğŸ•“ Ø¨Ú©Ø§Ù¾ Ø®ÙˆØ¯Ú©Ø§Ø± Ø²Ù…Ø§Ù† Ø®Ø±ÙˆØ¬
// ------------------------------
window.addEventListener('beforeunload', () => {
  localStorage.setItem('transactions', JSON.stringify(transactions));
});

// ------------------------------
// ğŸ§® Ù…Ø§Ø´ÛŒÙ† Ø­Ø³Ø§Ø¨ Ø¯Ø§Ø®Ù„ÛŒ (Ø³Ø§Ø¯Ù‡)
// ------------------------------
function quickCalc(expression) {
  try { return eval(expression); }
  catch { return 'Ø®Ø·Ø§'; }
}

// ------------------------------
// Ù¾Ø§ÛŒØ§Ù†
// ------------------------------
</script>

<footer style="text-align:center;padding:1rem;font-size:0.8rem;color:gray;">
  Mia AI Â© 2025 â€” Ù†Ø³Ø®Ù‡ ÙØ§Ø² Ø¯ÙˆÙ…
</footer>

</body>
</html>
