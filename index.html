<!DOCTYPE html>
<html lang="fa" dir="rtl">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <title>Ø­Ø³Ø§Ø¨Ø¯Ø§Ø± Ù‡ÙˆØ´Ù…Ù†Ø¯ Ù¾Ø§Ø±Ù…ÛŒØ³</title>
  <style>
    :root {
      --bg: #fff;
      --text: #111;
      --primary: #6b3fa0;
      --accent: #d9b44a;
    }
    [data-theme="dark"] {
      --bg: #111;
      --text: #eee;
      --primary: #0d6efd;
      --accent: #444;
    }
    [data-theme="light"] {
      --bg: #fdfdfd;
      --text: #222;
      --primary: #0066cc;
      --accent: #ccc;
    }
    [data-theme="parmis"] {
      --bg: #f9f6ff;
      --text: #2a1f43;
      --primary: #7b4b9a;
      --accent: #dcb34a;
    }
    body {
      background: var(--bg);
      color: var(--text);
      font-family: 'Vazirmatn', sans-serif;
      margin: 0;
      padding: 0;
      display: flex;
      flex-direction: column;
      min-height: 100vh;
    }
    header {
      background: var(--primary);
      color: #fff;
      padding: 10px 15px;
      display: flex;
      justify-content: space-between;
      align-items: center;
    }
    nav {
      display: flex;
      flex-wrap: wrap;
      background: var(--accent);
      padding: 5px;
    }
    nav button {
      flex: 1;
      background: none;
      border: none;
      padding: 10px;
      cursor: pointer;
      color: var(--text);
      font-weight: bold;
    }
    main { flex: 1; padding: 10px; }
    .page { display: none; }
    .page.active { display: block; }
    form { display: flex; flex-wrap: wrap; gap: 5px; margin-bottom: 10px; }
    input, select, button {
      padding: 8px;
      border-radius: 6px;
      border: 1px solid #aaa;
      font-family: inherit;
    }
    button {
      background: var(--primary);
      color: #fff;
      cursor: pointer;
      transition: 0.3s;
    }
    button:hover { opacity: 0.8; }
    footer {
      text-align: center;
      padding: 10px;
      background: var(--accent);
    }
    .summary { display: flex; gap: 20px; font-size: 1.2em; }
    #transaction-list, #mini-list { margin-top: 10px; }
    .item { padding: 6px; border-bottom: 1px solid #ccc; }
  </style>
</head>

<body data-theme="parmis">
<header>
  <h1>ğŸ“’ Ø­Ø³Ø§Ø¨Ø¯Ø§Ø± Ù‡ÙˆØ´Ù…Ù†Ø¯</h1>
  <select id="theme-selector">
    <option value="parmis">Ù¾Ø§Ø±Ù…ÛŒØ³ Ú©Ù„Ø§Ø³ÛŒÚ©</option>
    <option value="dark">Ù…Ø¯Ø±Ù† ØªÛŒØ±Ù‡</option>
    <option value="light">Ø±ÙˆØ´Ù† Ø³Ø§Ø¯Ù‡</option>
    <option value="auto">Ø³ÛŒØ³ØªÙ… Ø®ÙˆØ¯Ú©Ø§Ø±</option>
  </select>
</header>

<nav id="main-menu">
  <button data-page="dashboard">ğŸ  Ø¯Ø§Ø´Ø¨ÙˆØ±Ø¯</button>
  <button data-page="transactions">ğŸ’° ØªØ±Ø§Ú©Ù†Ø´â€ŒÙ‡Ø§</button>
  <button data-page="accounts">ğŸ¦ Ø­Ø³Ø§Ø¨â€ŒÙ‡Ø§</button>
  <button data-page="reports">ğŸ“Š Ú¯Ø²Ø§Ø±Ø´â€ŒÙ‡Ø§</button>
  <button data-page="mini">âš¡ Ø­Ø³Ø§Ø¨Ø¯Ø§Ø±ÛŒ Ø³Ø¨Ú©</button>
  <button data-page="settings">âš™ï¸ ØªÙ†Ø¸ÛŒÙ…Ø§Øª</button>
</nav>

<main id="content">
  <section id="dashboard" class="page active">
    <h2>Ø®Ù„Ø§ØµÙ‡ Ù…Ø§Ù„ÛŒ</h2>
    <div class="summary">
      <div>ğŸ’µ Ø¯Ø±Ø¢Ù…Ø¯: <span id="income-total">0</span></div>
      <div>ğŸ’¸ Ù‡Ø²ÛŒÙ†Ù‡: <span id="expense-total">0</span></div>
      <div>ğŸ’° Ù…Ø§Ù†Ø¯Ù‡: <span id="balance-total">0</span></div>
    </div>
    <canvas id="yearChart"></canvas>
  </section>

  <section id="transactions" class="page">
    <h2>Ø«Ø¨Øª ØªØ±Ø§Ú©Ù†Ø´ Ø¬Ø¯ÛŒØ¯</h2>
    <form id="transaction-form">
      <input type="text" id="category" placeholder="Ø¯Ø³ØªÙ‡ (Ù…Ø«Ù„Ø§Ù‹ Ø³ÙˆÙ¾Ø±Ù…Ø§Ø±Ú©Øª)">
      <input type="text" id="desc" placeholder="ØªÙˆØ¶ÛŒØ­">
      <input type="number" id="amount" placeholder="Ù…Ø¨Ù„Øº">
      <select id="type">
        <option value="income">Ø¯Ø±Ø¢Ù…Ø¯</option>
        <option value="expense">Ù‡Ø²ÛŒÙ†Ù‡</option>
      </select>
      <button type="submit">â• Ø«Ø¨Øª</button>
    </form>
    <div id="transaction-list"></div>
  </section>

  <section id="mini" class="page">
    <h2>Ø­Ø³Ø§Ø¨Ø¯Ø§Ø±ÛŒ Ø³Ø¨Ú©</h2>
    <form id="mini-form">
      <input type="text" id="mini-desc" placeholder="ØªÙˆØ¶ÛŒØ­">
      <input type="number" id="mini-amount" placeholder="Ù…Ø¨Ù„Øº">
      <select id="mini-type">
        <option value="income">Ø¯Ø±Ø¢Ù…Ø¯</option>
        <option value="expense">Ù‡Ø²ÛŒÙ†Ù‡</option>
      </select>
      <button type="submit">â• Ø§ÙØ²ÙˆØ¯Ù†</button>
    </form>
    <div id="mini-list"></div>
  </section>

  <section id="settings" class="page">
    <h2>ØªÙ†Ø¸ÛŒÙ…Ø§Øª</h2>
    <button id="backup-now">ğŸ’¾ Ø¨Ú©Ø§Ù¾</button>
    <button id="close-fiscal-year">ğŸ“… Ø¨Ø³ØªÙ† Ø³Ø§Ù„ Ù…Ø§Ù„ÛŒ</button>
    <button id="reset-data">ğŸ§¨ Ø­Ø°Ù Ú©Ù„ Ø¯Ø§Ø¯Ù‡â€ŒÙ‡Ø§</button>
  </section>
</main>

<footer>
  <p>Â© 2025 Ø­Ø³Ø§Ø¨Ø¯Ø§Ø± Ù‡ÙˆØ´Ù…Ù†Ø¯ Ù¾Ø§Ø±Ù…ÛŒØ³ â€” Ù†Ø³Ø®Ù‡ Ø¢ÙÙ„Ø§ÛŒÙ†</p>
</footer>

<script src="https://cdn.jsdelivr.net/npm/chart.js"></script>
<script>
  /* =========================
   ğŸ’¡ Ø¯Ø§Ø¯Ù‡â€ŒÙ‡Ø§ Ùˆ Ù…ØªØºÛŒØ±Ù‡Ø§ÛŒ Ø§ØµÙ„ÛŒ
   ========================= */
let transactions = JSON.parse(localStorage.getItem('transactions') || '[]');
let miniData = JSON.parse(localStorage.getItem('miniData') || '[]');
let fiscalYear = JSON.parse(localStorage.getItem('fiscalYear') || '{"year":1404,"active":true}');
let theme = localStorage.getItem('theme') || 'parmis';

/* =========================
   ğŸ§­ Ù†Ø§ÙˆØ¨Ø±ÛŒ Ø¨ÛŒÙ† ØµÙØ­Ø§Øª
   ========================= */
const pages = document.querySelectorAll('.page');
document.querySelectorAll('#main-menu button').forEach(btn=>{
  btn.onclick = ()=>{
    pages.forEach(p=>p.classList.remove('active'));
    document.getElementById(btn.dataset.page).classList.add('active');
  };
});

/* =========================
   ğŸ¨ Ù…Ø¯ÛŒØ±ÛŒØª ØªÙ…â€ŒÙ‡Ø§
   ========================= */
const themeSelector = document.getElementById('theme-selector');
function applyTheme(th){
  if(th==='auto'){
    const prefersDark = window.matchMedia('(prefers-color-scheme: dark)').matches;
    document.body.dataset.theme = prefersDark?'dark':'light';
  } else {
    document.body.dataset.theme = th;
  }
  localStorage.setItem('theme', th);
  themeSelector.value = th;
}
themeSelector.onchange = e=>applyTheme(e.target.value);
applyTheme(theme);

/* =========================
   ğŸ’° Ø«Ø¨Øª ØªØ±Ø§Ú©Ù†Ø´ Ø¬Ø¯ÛŒØ¯
   ========================= */
document.getElementById('transaction-form').onsubmit = e=>{
  e.preventDefault();
  const category = categoryInput.value.trim();
  const desc = document.getElementById('desc').value.trim();
  const amount = parseFloat(document.getElementById('amount').value);
  const type = document.getElementById('type').value;
  if(!amount) return;
  transactions.push({category,desc,amount,type,date:new Date().toLocaleDateString('fa-IR')});
  localStorage.setItem('transactions', JSON.stringify(transactions));
  renderTransactions();
  updateDashboard();
  e.target.reset();
};
const categoryInput=document.getElementById('category');
function renderTransactions(){
  const list = document.getElementById('transaction-list');
  list.innerHTML = '';
  transactions.forEach((t,i)=>{
    const div=document.createElement('div');
    div.className='item';
    div.textContent=`${t.date} | ${t.category} - ${t.desc} : ${t.amount.toLocaleString()} (${t.type==='income'?'Ø¯Ø±Ø¢Ù…Ø¯':'Ù‡Ø²ÛŒÙ†Ù‡'})`;
    list.appendChild(div);
  });
}
renderTransactions();

/* =========================
   âš¡ Ø­Ø³Ø§Ø¨Ø¯Ø§Ø±ÛŒ Ø³Ø¨Ú© Ø¯Ø§Ø®Ù„ÛŒ
   ========================= */
document.getElementById('mini-form').onsubmit = e=>{
  e.preventDefault();
  const desc=document.getElementById('mini-desc').value.trim();
  const amount=parseFloat(document.getElementById('mini-amount').value);
  const type=document.getElementById('mini-type').value;
  if(!amount)return;
  miniData.push({desc,amount,type,date:new Date().toLocaleDateString('fa-IR')});
  localStorage.setItem('miniData', JSON.stringify(miniData));
  renderMini();
  e.target.reset();
};
function renderMini(){
  const list=document.getElementById('mini-list');
  list.innerHTML='';
  miniData.forEach(t=>{
    const div=document.createElement('div');
    div.className='item';
    div.textContent=`${t.date} | ${t.desc} : ${t.amount.toLocaleString()} (${t.type==='income'?'Ø¯Ø±Ø¢Ù…Ø¯':'Ù‡Ø²ÛŒÙ†Ù‡'})`;
    list.appendChild(div);
  });
}
renderMini();

/* =========================
   ğŸ“Š Ø¯Ø§Ø´Ø¨ÙˆØ±Ø¯ Ùˆ Ø¬Ù…Ø¹â€ŒÙ‡Ø§
   ========================= */
function updateDashboard(){
  const income=transactions.filter(t=>t.type==='income').reduce((a,b)=>a+b.amount,0);
  const expense=transactions.filter(t=>t.type==='expense').reduce((a,b)=>a+b.amount,0);
  const balance=income-expense;
  document.getElementById('income-total').textContent=income.toLocaleString();
  document.getElementById('expense-total').textContent=expense.toLocaleString();
  document.getElementById('balance-total').textContent=balance.toLocaleString();
  drawChart(income,expense);
}
function drawChart(income,expense){
  const ctx=document.getElementById('yearChart').getContext('2d');
  if(window.chart) window.chart.destroy();
  window.chart=new Chart(ctx,{type:'doughnut',data:{labels:['Ø¯Ø±Ø¢Ù…Ø¯','Ù‡Ø²ÛŒÙ†Ù‡'],datasets:[{data:[income,expense],backgroundColor:['#28a745','#dc3545']}]},options:{plugins:{legend:{position:'bottom'}}}});
}
updateDashboard();

/* =========================
   ğŸ“¦ Ø¨Ú©Ø§Ù¾ Ø¯Ø³ØªÛŒ Ùˆ Ø®ÙˆØ¯Ú©Ø§Ø±
   ========================= */
document.getElementById('backup-now').onclick = ()=>doBackup();
function doBackup(){
  const data={transactions,miniData,fiscalYear,date:new Date()};
  localStorage.setItem('backup_'+new Date().getTime(),JSON.stringify(data));
  alert('Ø¨Ú©Ø§Ù¾ Ø¨Ø§ Ù…ÙˆÙÙ‚ÛŒØª Ø°Ø®ÛŒØ±Ù‡ Ø´Ø¯ âœ…');
}
setInterval(()=>{
  const h=new Date().getHours();
  if(h===2){ doBackup(); }
},3600000);

/* =========================
   ğŸ“… Ø¨Ø³ØªÙ† Ø³Ø§Ù„ Ù…Ø§Ù„ÛŒ Ø¨Ø§ ØªØ£ÛŒÛŒØ¯ Ú©Ø§Ø±Ø¨Ø±
   ========================= */
document.getElementById('close-fiscal-year').onclick = ()=>{
  const y=fiscalYear.year;
  if(confirm(`Ø¢ÛŒØ§ Ù…ÛŒâ€ŒØ®ÙˆØ§Ù‡ÛŒØ¯ Ø³Ø§Ù„ Ù…Ø§Ù„ÛŒ ${y} Ø¨Ø³ØªÙ‡ Ø´ÙˆØ¯ Ùˆ Ø³Ø§Ù„ Ø¬Ø¯ÛŒØ¯ Ø¢ØºØ§Ø² Ø´ÙˆØ¯ØŸ`)){
    localStorage.setItem('archive_'+y,JSON.stringify(transactions));
    fiscalYear={year:y+1,active:true};
    transactions=[];
    localStorage.setItem('transactions','[]');
    localStorage.setItem('fiscalYear',JSON.stringify(fiscalYear));
    alert(`Ø³Ø§Ù„ ${y} Ø¨Ø³ØªÙ‡ Ø´Ø¯ âœ… Ùˆ Ø³Ø§Ù„ ${y+1} Ø¢ØºØ§Ø² Ø´Ø¯.`);
    renderTransactions();
    updateDashboard();
  }
};

/* =========================
   ğŸ§¨ Ø­Ø°Ù Ú©Ù„ Ø¯Ø§Ø¯Ù‡â€ŒÙ‡Ø§
   ========================= */
document.getElementById('reset-data').onclick = ()=>{
  if(confirm('Ø¢ÛŒØ§ Ù…Ø·Ù…Ø¦Ù† Ù‡Ø³ØªÛŒØ¯ØŸ ØªÙ…Ø§Ù… Ø¯Ø§Ø¯Ù‡â€ŒÙ‡Ø§ Ø­Ø°Ù Ø®ÙˆØ§Ù‡Ù†Ø¯ Ø´Ø¯.')){
    localStorage.clear();
    transactions=[]; miniData=[];
    renderTransactions(); renderMini(); updateDashboard();
    alert('ØªÙ…Ø§Ù… Ø¯Ø§Ø¯Ù‡â€ŒÙ‡Ø§ Ù¾Ø§Ú© Ø´Ø¯ âŒ');
  }
};
  /* =========================
   ğŸ“ˆ Ú¯Ø²Ø§Ø±Ø´â€ŒÙ‡Ø§ Ùˆ Ù†Ù…ÙˆØ¯Ø§Ø± Ø³Ø§Ù„Ø§Ù†Ù‡
   ========================= */
function renderReports(){
  const monthly = {};
  transactions.forEach(t=>{
    const m=new Date().getMonth();
    if(!monthly[m]) monthly[m]={income:0,expense:0};
    monthly[m][t.type]+=t.amount;
  });
  const labels=Object.keys(monthly).map(m=>`Ù…Ø§Ù‡ ${+m+1}`);
  const incomeData=Object.values(monthly).map(v=>v.income);
  const expenseData=Object.values(monthly).map(v=>v.expense);
  const ctx=document.getElementById('chart').getContext('2d');
  if(window.chart2) window.chart2.destroy();
  window.chart2=new Chart(ctx,{
    type:'bar',
    data:{labels,datasets:[
      {label:'Ø¯Ø±Ø¢Ù…Ø¯',data:incomeData,backgroundColor:'#28a745'},
      {label:'Ù‡Ø²ÛŒÙ†Ù‡',data:expenseData,backgroundColor:'#dc3545'}
    ]},
    options:{plugins:{legend:{position:'bottom'}}}
  });
}
document.querySelector('[data-page="reports"]').addEventListener('click',renderReports);

/* =========================
   ğŸ™ï¸ Ø­Ø§Ù„Øª ØµÙˆØªÛŒ ÙØ§Ø±Ø³ÛŒ (Ø¢Ø²Ù…Ø§ÛŒØ´ÛŒ)
   ========================= */
const voiceBtn=document.createElement('button');
voiceBtn.textContent='ğŸ¤ Ø´Ø±ÙˆØ¹ Ø¶Ø¨Ø· ØµÙˆØªÛŒ';
voiceBtn.style.margin='10px';
document.getElementById('settings').appendChild(voiceBtn);
voiceBtn.onclick=()=>{
  if(!('webkitSpeechRecognition' in window)){alert('Ù…Ø±ÙˆØ±Ú¯Ø± Ø´Ù…Ø§ Ø§Ø² Ú¯ÙØªØ§Ø± Ù¾Ø´ØªÛŒØ¨Ø§Ù†ÛŒ Ù†Ù…ÛŒâ€ŒÚ©Ù†Ø¯');return;}
  const rec=new webkitSpeechRecognition();
  rec.lang='fa-IR'; rec.start();
  rec.onresult=e=>{
    const text=e.results[0][0].transcript;
    alert('Ù…ØªÙ† Ø¯Ø±ÛŒØ§ÙØª Ø´Ø¯: '+text);
    if(text.includes('Ø¯Ø±Ø¢Ù…Ø¯')){
      const num=parseInt(text.replace(/[^0-9Û°-Û¹]/g,''));
      if(num) transactions.push({desc:'Ø¯Ø±Ø¢Ù…Ø¯ ØµÙˆØªÛŒ',amount:num,type:'income',date:new Date().toLocaleDateString('fa-IR')});
    }
    if(text.includes('Ù‡Ø²ÛŒÙ†Ù‡')){
      const num=parseInt(text.replace(/[^0-9Û°-Û¹]/g,''));
      if(num) transactions.push({desc:'Ù‡Ø²ÛŒÙ†Ù‡ ØµÙˆØªÛŒ',amount:num,type:'expense',date:new Date().toLocaleDateString('fa-IR')});
    }
    localStorage.setItem('transactions',JSON.stringify(transactions));
    renderTransactions(); updateDashboard();
  };
};

/* =========================
   ğŸŒ— ØªÙ… Ø®ÙˆØ¯Ú©Ø§Ø± Ø¨Ø± Ø§Ø³Ø§Ø³ Ø³ÛŒØ³ØªÙ…
   ========================= */
window.matchMedia('(prefers-color-scheme: dark)').addEventListener('change',()=>{
  if(localStorage.getItem('theme')==='auto') applyTheme('auto');
});

/* =========================
   ğŸš€ Ø§Ø¬Ø±Ø§ÛŒ Ø§ÙˆÙ„ÛŒÙ‡
   ========================= */
renderTransactions();
renderMini();
updateDashboard();

</script>
</body>
</html>
